<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مزرعتي الواقعية</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
<style>
body { margin:0; padding:0; font-family: Arial; background:#6ab04c; }
#game-container { width:100%; height:100vh; }
#ui { position:absolute; top:10px; left:10px; color:#fff; z-index:10; }
button { padding:5px 10px; margin:2px; cursor:pointer; }
#store { display:none; background:#fff; color:#000; padding:5px; margin-top:5px; position:absolute; top:50px; left:10px; z-index:10; }
</style>
</head>
<body>
<div id="game-container"></div>
<div id="ui">
<span id="goldText">الذهب: 500</span> | <span id="levelText">المستوى: 1</span><br>
<button onclick="openStore()">المتجر</button>
<button onclick="saveGame()">حفظ اللعبة</button>
<div id="store">
<h4>المتجر</h4>
<button onclick="buyItem('دجاج',50)">دجاج - 50 ذهب</button>
<button onclick="buyItem('بقر',200)">بقر - 200 ذهب</button>
<button onclick="buyItem('طماطم',10)">طماطم - 10 ذهب</button>
<button onclick="closeStore()">إغلاق المتجر</button>
</div>
</div>

<script>
// بيانات اللاعب
let playerData = { gold:500, level:1, experience:0, inventory:{}, farm:[] };

// إعداد Phaser
const config = {
    type: Phaser.AUTO,
    width: 600,
    height: 400,
    parent: 'game-container',
    physics: { default: 'arcade', arcade: { debug: false } },
    scene: { preload, create, update }
};
const game = new Phaser.Game(config);
let farmTiles = [];

function preload() {
    // تحميل الصور
    this.load.image('grass','https://i.imgur.com/JlZx1ZV.png'); // العشب
    this.load.image('dirt','https://i.imgur.com/4p0u7TG.png'); // تربة طينية واقعية
    this.load.spritesheet('chicken','https://i.imgur.com/KhH1F4M.png',{ frameWidth:32, frameHeight:32 });
    this.load.spritesheet('cow','https://i.imgur.com/3pXvRSR.png',{ frameWidth:32, frameHeight:32 });
    this.load.image('tomato','https://i.imgur.com/YJ2RslQ.png');
}

function create() {
    // إنشاء مزرعة 5x5 مربعات تربة
    let startX = 80, startY = 60;
    let tileWidth = 80, tileHeight = 50;
    for(let y=0;y<5;y++){
        for(let x=0;x<5;x++){
            // خريطة العشب خلف التربة
            this.add.image(startX + x*tileWidth, startY + y*tileHeight, 'grass').setScale(1.2);
            // التربة الطينية
            let tile = this.add.image(startX + x*tileWidth, startY + y*tileHeight, 'dirt').setInteractive();
            tile.displayWidth = tileWidth - 4; // جعلها تبدو مثل أرض الزراعة
            tile.displayHeight = tileHeight - 4;
            tile.on('pointerdown', ()=>plantCrop(tile,x + y*5));
            farmTiles.push({sprite:tile, crop:null});
        }
    }

    // وضع بعض المحاصيل الافتراضية (طماطم)
    for(let i=0;i<5;i++){
        let cropSprite = this.add.image(farmTiles[i].sprite.x, farmTiles[i].sprite.y-15,'tomato').setScale(0.8);
        farmTiles[i].crop = cropSprite;
    }

    // الحيوانات المتحركة
    this.chicken = this.add.sprite(450,100,'chicken').play('walkChicken');
    this.cow = this.add.sprite(520,200,'cow').play('walkCow');

    this.anims.create({key:'walkChicken', frames:this.anims.generateFrameNumbers('chicken',{start:0,end:3}), frameRate:4, repeat:-1});
    this.anims.create({key:'walkCow', frames:this.anims.generateFrameNumbers('cow',{start:0,end:3}), frameRate:2, repeat:-1});

    // استعادة البيانات
    const saved = localStorage.getItem('farmGame');
    if(saved) playerData = JSON.parse(saved);
    updateUI();
}

// زرع المحاصيل
function plantCrop(tile,index){
    const crop = prompt('اختر محصول للزرع: طماطم');
    if(crop==='طماطم'){
        if(farmTiles[index].crop) return alert('يوجد محصول هنا!');
        let cropSprite = game.scene.scenes[0].add.image(tile.x, tile.y-15,'tomato').setScale(0.8);
        farmTiles[index].crop = cropSprite;
        playerData.experience += 10;
        playerData.gold += 20;
        checkLevel();
        updateUI();
        alert('تم زرع وحصاد '+crop);
    }
}

// المتجر
function openStore(){ document.getElementById('store').style.display='block'; }
function closeStore(){ document.getElementById('store').style.display='none'; }

function buyItem(name, price){
    if(playerData.gold>=price){
        playerData.gold-=price;
        if(!playerData.inventory[name]) playerData.inventory[name]=0;
        playerData.inventory[name]++;
        updateUI();
        alert('تم شراء '+name);
    } else alert('لا يوجد ذهب كافي');
}

// تحديث الواجهة
function updateUI(){
    document.getElementById('goldText').innerText = 'الذهب: '+playerData.gold;
    document.getElementById('levelText').innerText = 'المستوى: '+playerData.level;
}

// فحص المستوى
function checkLevel(){
    if(playerData.experience >= playerData.level*50){
        playerData.experience = 0;
        playerData.level++;
        alert('تهانينا! وصلت للمستوى '+playerData.level);
        updateUI();
    }
}

// حفظ اللعبة
function saveGame(){
    localStorage.setItem('farmGame',JSON.stringify(playerData));
    console.log('تم حفظ اللعبة!');
}

// حفظ تلقائي كل دقيقة
setInterval(()=>{ saveGame(); },60000);

function update(){}
</script>
</body>
</html>
