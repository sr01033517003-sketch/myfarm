<script>
        let data = { user: "", gold: 1000, inv: 0, energy: 100, lvl: 1 };

        function login() {
            let u = document.getElementById('username').value.trim();
            if(!u) return alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ");
            
            let saved = localStorage.getItem('pro_farm_' + u) || 
                        localStorage.getItem('happy_farm_' + u) || 
                        localStorage.getItem('farm_' + u);
            
            if(saved) {
                data = JSON.parse(saved);
            } else {
                data.user = u;
            }
            
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
            initGrid();
            update();
            setInterval(regenEnergy, 5000);
        }

        function initGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = ""; // Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø±Ø¶ Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
            for(let i=0; i<16; i++) {
                let p = document.createElement('div');
                p.className = 'plot';
                p.onclick = () => work(p);
                grid.appendChild(p);
            }
        }

        function work(p) {
            if(p.innerHTML === "" && data.energy >= 10) {
                data.energy -= 10;
                p.innerHTML = "ğŸŒ±";
                update();
                setTimeout(() => {
                    p.innerHTML = (data.lvl >= 3) ? "ğŸ“" : "ğŸŒ¾"; 
                    p.onclick = () => {
                        data.inv++;
                        p.innerHTML = "";
                        p.onclick = () => work(p);
                        checkLevel(); // ÙØ­Øµ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¹Ù†Ø¯ ÙƒÙ„ Ø­ØµØ§Ø¯
                        update();
                    };
                }, 3000);
            } else if(data.energy < 10) { alert("Ø·Ø§Ù‚ØªÙƒ Ù†ÙØ°Øª! Ø§Ø±ØªØ§Ø­ Ø£Ùˆ Ø§Ø´ØªØ±Ù Ø·Ø§Ù‚Ø©."); }
        }

        function checkLevel() {
            let oldLvl = data.lvl;
            if (data.gold >= 10000) data.lvl = 4;
            else if (data.gold >= 5000) data.lvl = 3;
            else if (data.gold >= 2000) data.lvl = 2;
            
            if (data.lvl > oldLvl) {
                alert("ğŸŠ Ù…Ø¨Ø±ÙˆÙƒ! Ø§Ø±ØªÙØ¹ Ù…Ø³ØªÙˆØ§Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ " + data.lvl);
            }
        }

        function sellEverything() {
            if(data.inv > 0) {
                let price = (data.lvl >= 3) ? 300 : 150; // Ø§Ù„Ù…Ø­ØµÙˆÙ„ Ø£ØºÙ„Ù‰ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©
                data.gold += data.inv * price;
                data.inv = 0;
                checkLevel(); // ÙØ­Øµ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ¹
                update();
                alert("ØªÙ… Ø¨ÙŠØ¹ Ø§Ù„Ù…Ø­ØµÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
            }
        }

        function buyEnergy() {
            if(data.gold >= 50) {
                data.gold -= 50;
                data.energy = Math.min(data.energy + 30, 100);
                update();
            }
        }

        function regenEnergy() {
            if(data.energy < 100) {
                data.energy += 2;
                update();
            }
        }

        function update() {
            document.getElementById('gold').innerText = data.gold;
            document.getElementById('energy-text').innerText = data.energy;
            document.getElementById('energy-fill').style.width = data.energy + "%";
            document.getElementById('inv').innerText = data.inv;
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            if(document.getElementById('lvl-display')) {
                document.getElementById('lvl-display').innerText = data.lvl;
            }
            localStorage.setItem('pro_farm_' + data.user, JSON.stringify(data));
        }
                </script>
